# Context

**Module:** {{ module }}
**Ansible Output:** {{ ansible_path }}

## Migration Plans

A high-level migration plan describing all cookbooks in the repository is available at: {{ high_level_migration_plan.path }}
(Read this file if you need context about how this module relates to other cookbooks in the migration)

**Module Plan:**
{{ migration_plan }}

{% if aap_discovery and aap_discovery.enabled and aap_discovery.content %}
## AAP Private Hub Collections (USE THESE!)

The following collections are available and MUST be used instead of writing custom tasks:

{{ aap_discovery.content }}

**CRITICAL RULES**:
1. For technologies covered by collections listed above → Use `include_role` with the collection's role
2. For technologies NOT covered by any collection above → Write custom tasks using ansible.builtin modules (package, template, service)
3. DO NOT invent or assume collection roles - only use roles from collections EXPLICITLY listed above
4. DO NOT create templates for technologies covered by a discovered collection
{% if aap_discovery.requirements_yaml %}

## Pre-Generated requirements.yml (USE THIS!)

The following requirements.yml has been generated from AAP Private Hub discovery with exact versions.
When writing requirements.yml, use this content EXACTLY (do not add public Galaxy collections):

```yaml
{{ aap_discovery.requirements_yaml }}
```

Write this content to `{{ ansible_path }}/requirements.yml` using ansible_write.
{% endif %}
{% endif %}

## Current Checklist

<checklist>
{{ checklist }}
</checklist>

# Workflow

CRITICAL INSTRUCTIONS:
- Process ALL items marked "pending" or "missing" in the checklist
- NEVER write or overwrite files marked "complete"
- Work autonomously without asking for user input
- Do NOT stop after listing items - immediately begin processing them

## Step 1: Get All Pending Tasks

Call list_checklist_tasks to identify all pending/missing items.

## Step 2: Process ALL Pending Items Immediately

Process every item that is NOT marked "complete". For EACH pending item, execute these steps in sequence:

1. **Verify status**: If checklist shows "complete", skip to next item
2. **Check existence**: If target file exists, skip to next item
3. **Read source**: Call read_file with source path (skip if source is "N/A")
4. **Convert content**: Apply conversion rules from system prompt
5. **Write file**: Call appropriate tool:
   - `ansible_write`: For tasks, handlers, defaults, vars, meta (YAML files)
   - `write_file`: For templates (.j2) and other non-YAML files
   - `copy_file`: For static files from files/ directory
6. **Handle errors**: If ansible_write returns ERROR, fix YAML and retry (do NOT use write_file as fallback)
7. **Update checklist**: Call update_checklist_task with exact paths, status "complete", and notes

**IMPORTANT**: Do NOT ask which item to process. Process ALL pending items automatically.

## Step 3: Validate (Optional)

After all files are written, run ansible_lint on output directory to catch syntax issues.

## Step 4: Report Summary

After processing all items, provide final report:
- **COMPLETED**: List all successfully migrated files
- **SKIPPED**: List files skipped (already exists/complete)
- **ISSUES**: List any errors encountered

Work through the ENTIRE checklist systematically until all pending/missing items are complete.
